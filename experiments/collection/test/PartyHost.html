<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" charset="utf-8" src='../../a2a-stub/include/a2a-stub.js'></script>
<script type="text/javascript" charset="utf-8" src='../PartyCollection.js'></script>

<style>
body { font-family: sans-serif; }
#log { clear: both; }
.logline {
    font-family: monospace;
    color: #ddd;
    background: #333;
    clear: both;
}
</style>

<script type=text/javascript>
    var channel = null;

    function log(message)
    {
        var logline = document.createElement('div');
        logline.setAttribute('class', 'logline');
        logline.innerHTML=message;
        var log = document.getElementById('log');
        log.insertBefore(logline, log.firstElementChild);
    }

    // in real life there would be no init(), this is a temporary solution
    function init()
    {
        webinos.app2app.init('ws://localhost:10666/a2a-stub');
        //webinos.app2app.createChannel('urn:partyplayer', null, function(msg) { log(msg); });
    }

    function search()
    {
        webinos.app2app.searchForChannels(
            'urn:webinos.org:*', [],
            function(channel) {
                log('Found channel with namespace ' +  channel.namespace);
            });
    }

    function create()
    {
        channel = webinos.app2app.createChannel(
            'urn:webinos.org:partyplayer', null, alwaysTrue,
            function handleMessage(payload) {
                // payload is an object
                log('Received payload: ' + JSON.stringify(payload));
            });
    }

    function send()
    {
        channel.send(document.getElementById('message').value);
    }

    function alwaysTrue()
    {
        return true;
    }

</script>
</head>

<body>
    <h2>webinos App2App stub tester</h2>
    <form action="" method="get" accept-charset="utf-8">
        <input type="button" value="Init" onclick="javascript:init();">
        <input type="button" value="Search" onclick="javascript:search();">
        <input type="button" value="Create" onclick="javascript:create();">
        <input type="button" value="Send" onclick="javascript:send();">
        <input type="text" id="message" size="60"
            placeholder="Type JSON here..."
            value='{"type":"chat","msg":"vrolijke boel"}'><br>
    </form>

    <h3>Logging</h3>
    <div id=log>
        <div class=logline>Testing one ... two ... in the place to be!</div>
    </div>
</body>
</html>

